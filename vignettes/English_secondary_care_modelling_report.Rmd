---
title: "The use of English Admitted Patient Care Hospital Episode Statistics to inform time-trends in the rates and costs of secondary care associated with tobacco and alcohol"
subtitle: Version 0.2.0
biblio-style: apalike
date: "**`r format(Sys.Date(), format = '%B %Y')`**"
output: 
  bookdown::pdf_document2:
    highlight: haddock
    number_sections: true
    toc: false
header-includes:
  - \usepackage{booktabs}
  - \usepackage{longtable}
  - \usepackage{array}
  - \usepackage{multirow}
  - \usepackage{wrapfig}
  - \usepackage{float}
  - \usepackage{colortbl}
  - \usepackage{pdflscape}
  - \usepackage{tabu}
  - \usepackage{threeparttable}
  - \usepackage{threeparttablex}
  - \usepackage[normalem]{ulem}
  - \usepackage[normalem]{ulem}
  - \usepackage[utf8]{inputenc}
  - \usepackage{makecell}
  - \usepackage{amsmath}
  - \usepackage{graphicx}
  - \usepackage{titling}
  - \pretitle{\begin{center}
    \includegraphics[width=3in,height=2in]{inst/TUOS_PRIMARY_LOGO_FULL COLOUR.jpg}\LARGE\\\vskip 3em}
  - \posttitle{\end{center}\vskip 4em}
  - \usepackage{tcolorbox}
  - \usepackage{xcolor}
  - \usepackage{hyperref}
link-citations: yes
bibliography:
  - hes_refs.bib
  - packages.bib
  - disease-risks.bib
always_allow_html: yes
urlcolor: blue
vignette: >
  %\VignetteIndexEntry{English hospital costs methods}
  %\VignetteEncoding{UTF-8}
  %\VignetteEngine{knitr::rmarkdown}
editor_options: 
  chunk_output_type: console
pkgdown:
  as_is: true
  extension: pdf
---

Duncan Gillespie^1^, Laura Webster^1^, Colin Angus^1^ & Alan Brennan^1^

\vskip 1em

^1^School of Health and Related Research (ScHARR), The University of Sheffield

\vskip 1em

**Address for correspondence**:\
Dr Duncan Gillespie\
Section of Health Economics and Decision Science,\
School for Health and Related Research,\
The University of Sheffield,\
Regent Court, Regent Street, Sheffield, S1 4DA, UK\
Email: [duncan.gillespie\@sheffield.ac.uk](mailto:duncan.gillespie@sheffield.ac.uk){.email}

\vskip 1em

```{=tex}
\begin{tcolorbox}[colback=red!5!white,colframe=red!75!black,title=WARNING]
This is a working version that is subject to review and future versions are likely.
\end{tcolorbox}
```
\vskip 1em

The code that accompanies this report can be found here in the hesr R package (<https://stapm.gitlab.io/r-packages/hesr/>). This report is licensed to The University of Sheffield under a [CC by 4.0](https://creativecommons.org/licenses/by/4.0/) license.   

\newpage

```{r setup, include = FALSE, results = 'hide', warning = FALSE}

knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>",
  fig.pos = 'H'
)

options(tinytex.verbose = F)

suppressPackageStartupMessages(library(magrittr))
suppressPackageStartupMessages(library(knitr))
suppressPackageStartupMessages(library(kableExtra))
suppressPackageStartupMessages(library(data.table))
suppressPackageStartupMessages(library(ggplot2))
suppressPackageStartupMessages(library(readxl))
suppressPackageStartupMessages(library(tobalcepi))
suppressPackageStartupMessages(library(stapmr))
suppressPackageStartupMessages(library(smktrans))
suppressPackageStartupMessages(library(ggthemes))
suppressPackageStartupMessages(library(RColorBrewer))
suppressPackageStartupMessages(library(cowplot))

```

```{r include=FALSE, eval=F}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```
 
# Summary {-}
This methodology report sets out a description of how we estimate the rates and costs of English inpatient hospital care attributable to tobacco and/or alcohol. We review past methods and then explain our own methodological choice.

\newpage

# Glossary of terms {-}

```{r table1, eval = T, warning = F, echo=F, cache = F}

df_table1 <- readxl::read_xlsx('inst/Glossary.xlsx','glossary')

df_table1 %>%
  kableExtra::kbl(booktabs = T, caption = "Explanation of terms.", label = "table1", linesep = "\\hline", escape = F) %>%
  kableExtra::column_spec(column = 1, width = "5cm") %>%
  kableExtra::column_spec(column = 2, width = "11cm") %>%
  kableExtra::kable_styling(font_size = 8, latex_options = c("HOLD_position"))

```

\newpage

\hypersetup{linkcolor=blue}
\tableofcontents

\newpage

# Background
The NHS is under increasing pressure from a growing demand for secondary care, and inpatient care has been shown to be the main contributor to the total cost of healthcare provision [@geue2012spoilt]. A large proportion of inpatient care is preventable because it stems from past patient exposure to risk factors for ill-health, of which tobacco and alcohol rank highly. For England, NHS Digital statistics estimated that in 2017/18 there were 489,300 hospital admissions attributable to smoking (4\% of all hospital admissions) [@NHSDigitalTobacco2019], and 337,870 hospital admissions attributable to alcohol (narrow measure) [@NHSDigitalAlcohol2019]. Being able to link past tobacco and alcohol consumption to current inpatient care is therefore important to inform the potential health and economic consequences of public policy decisions that could affect tobacco and/or alcohol consumption. From a health sector perspective, public health policies aim to reduce the demand for and consequent public financial costs of healthcare. In doing so there is also the additional aim of narrowing the societal inequalities in health, i.e. it would be better for the greatest savings in the costs of care to come from those sectors of society who have the highest demand for care.     

## The HES Admitted Patient Care data
The Admitted Patient Care portion of the English Hospital Episode Statistics (HES) provides a huge resource of data for the estimation of the rates and costs of tobacco and alcohol related hospital care [@Herbert_2017]. HES is a data warehouse containing details of all admissions, outpatient appointments and A\&E attendances at NHS hospitals in England. Each HES record contains a wide range of information about a patient including clinical information about diagnoses and operations, patient information such as age, sex, and socio-economic conditions (deprivation quintile of residence), and administrative information such as dates of admission and discharge. We use data from the Admitted Patient Care (APC) component of the HES for patients resident in England.    

### Episodes and spells
HES information is recorded at the finished consultant episode (FCE) level, with an episode being a period of care within a particular consultant specialty at a single hospital provider. Episodes are frequently joined together to create spells, which refer to the time spent within a single hospital, or continuous inpatient spells (CIPS), which refer to the entire period of continuous inpatient care across multiple hospitals. An episode can be finished because of discharge to another consultant, transfer to another hospital or to place of residence or if the patient dies. As a result, a patient may have more than one FCE during an admission to hospital (86.7\% of all spells only contained a single episode [@Green_2017]).   
 
### Diagnosis and procedure codes
Each FCE has a series of these codes to determine which procedures and diagnoses have been carried out. HES uses the ICD-10 (International Classification of Disease and Related Health Problems, 10th revision) classification to record diagnosis information. An episode can contain up to twenty diagnostic codes, with the first diagnostic code being the primary diagnosis. The OPCS-4 (Office of Population, Censuses and Surveys: Classification of Interventions and Procedures, 4th revision) classification is used to record details of any procedures or interventions performed.   

### Costs 
Unit costs for episodes and spells of care can be derived from NHS reference costs. Hospital episodes and spells are linked to reference costs using the HRG4+ reference costs code to group workbook published by the NHS Information Centre. HRG grouper software is used to assign an HRG to every patient record. The software assigns an HRG code based on diagnosis, procedure performed, gender, age, length of stay, and the discharge method.


## Programme of work
Investigating the past trends in hospital admissions and costs associated with tobacco and alcohol consumption is fundamental to evaluating the effect of past policy and appraising the potential effects of new policy. We use HES APC data from 2002/3 for an on-going programme of work at The University of Sheffield to develop public health economic models for policymaker decision support in the fields of alcohol and tobacco control. This work is being conducted at a range of geographic scales, including national and local authority level. 

### Objectives
The programme of work has two objectives:   

1. To investigate past trends in alcohol and/or smoking related hospital admissions and costs. The data will also be used to investigate past policy effects on hospital admissions and associated costs.     
1. To investigate the potential future effects on hospital admissions and costs of proposed changes to alcohol and/or tobacco policy. We typically use the most recent years of data to inform the baseline rates of hospital admissions. We then update these rates according to estimate policy effects and project the outcomes over around 30 years.

### Diseases attributable to tobacco and/or alcohol
We use the HES APC data to investigate the rates and costs of hospital admissions associated with a set of conditions that have been classed as wholly- or partially-attributable to the consumption of tobacco or alcohol. Our list of conditions is large (84 separate ICD-10 categories in total) and includes several cancers, cardiovascular diseases and respiratory diseases. We consider 52 diseases related to tobacco [@Webster2018] and 45 diseases related to alcohol [@Angus2018] (we expand the alcohol list to 48 conditions when merging our tobacco and alcohol disease lists by subdividing some of the ICD-10 categories). Within our merged disease list, there are 15 conditions that are related to both tobacco and alcohol. 

# The aim of this report
There are three main problems to be solved in linking past patient tobacco and alcohol consumption to trends in the rates and costs of inpatient care:  

1. How to attribute a case of a disease in an individual to their current or past tobacco and/or alcohol consumption. For this, the NHS Digital statistics use survey data on tobacco or alcohol consumption and estimates of the relative risks of disease associated with tobacco or alcohol consumption to calculate Population Attributable Fractions (PAFs), which give an estimate of the percentage of disease cases that are likely to be due to tobacco or alcohol consumption.    
2. How to attribute inpatient care to those specific diseases.    
3. How to estimate the costs of hospital admissions that are attributed to tobacco and alcohol consumption.   

We address (1) in a separate report on tobacco and alcohol attributable fractions [*link to that report*]. This report is focused on explaining our choice of methodology for (2) Attributing inpatient care to specific diseases, and (3) Estimating the costs of hospital admissions that are attributed to tobacco and alcohol consumption.    

# Review of existing methods
We conducted a rapid review of reports and peer-reviewed publications that measure patient admissions using the HES data. We limited the geographical scope of our review to England. We time-limited our search to publications after 1998, when patients' NHS numbers became a mandated return from hospitals, allowing episodes to be linked to the same patient within the HES data. Whilst we primarily searched for publications related to tobacco or alcohol, methods used by other analyses will still be useful and so we did not limit our search to exclusively tobacco or alcohol related publications. We focus in particular on methods already used in work by The University of Sheffield (see [the Sheffield Alcohol Research Group webpage](https://www.sheffield.ac.uk/scharr/research/themes/alpol)), and in the English national statistics on tobacco and alcohol published by NHS Digital [@NHSDigitalTobacco2019;@NHSDigitalAlcohol2019].    

## Attributing inpatient care to specific diseases
Following an admission to hospital, an individual might see multiple consultants resulting in multiple episodes of care. Within each episode of care, there can be up to twenty diagnostic codes assigned. Assigning a single diagnosis as the cause of an admission can therefore be a task filled with uncertainty. Table \@ref(tab:table2) shows the main methods that we consider.  

```{r table2, eval = T, warning = F, echo=F, cache = F}

df_table2 <- readxl::read_xlsx('inst/attrib_methods.xlsx','Sheet1')

df_table2 %>%
  kableExtra::kbl(booktabs = T, caption = "Four alternative methods to attribute inpatient care to specific diseases.", label = "table2", linesep = "\\hline", escape = F) %>%
  kableExtra::column_spec(column = 1, width = "5cm") %>%
  kableExtra::column_spec(column = 2, width = "10cm") %>%
  kableExtra::kable_styling(font_size = 8, latex_options = c("HOLD_position"))

```

### Primary diagnostic position of the admission (first) episode
The NHS Digital statistics on the number of hospital admissions attributable to smoking [@NHSDigitalTobacco2019] refer to the number of finished admission episodes that have a primary diagnosis related to smoking, i.e. the ICD-10 disease code that appears in the first position in the list of disease diagnoses associated with the admission episode. However, using this method to select risk-related admissions is likely to underestimate the rates of hospital admissions associated with a specific diagnosis.     

Another approach used in the literature to attribute a disease diagnosis as the cause of an admission to hospital is to look at whether the diagnosis code for that disease occurs within the *first three diagnostic positions* of the admission episode [@Keeping_2015;@hobbelen2016burden]. This was designed to balance the risk of incorrectly excluding admissions as being attributable to a diagnosis by using too strict a definition with the risk of incorrectly including admissions not due to the condition by using too broad a definition. Hobbelen et al [-@hobbelen2016burden] then conducted sensitivity analyses to investigate how using the first three diagnostic positions compared to:  

1. Using the primary diagnosis of the admission episode (which reduced the yearly number of attributed hospital admissions by 25\%);
1. Using all diagnostic fields of the admission episode (which increased the yearly number of attributed hospital admissions by 3.4\%). 

### Narrow and broad methods for alcohol
The NHS Digital statistics on alcohol [@NHSDigitalAlcohol2019] use two methods to associate alcohol-related diagnoses with inpatient care:   

1. The 'narrow' measure looks only at whether the primary diagnosis of the admission episode is alcohol-related or whether an alcohol-related external cause has been recorded within the list of diagnoses related to that episode, e.g. assault (external conditions, which are environmental causes of injury occurring outside the body, do not feature as the primary diagnosis). This is in an effort to select the condition that is the cause of the episode. If there is an alcohol-related external cause, then this is assigned the cause of the episode; if there is no alcohol-related external cause, then the diagnosis in the primary diagnostic position is used. If this results in more than one alcohol-related diagnosis, then the diagnosis with the largest alcohol PAF is used. Green [-@Green_2017] analysed trends in alcohol-related admissions to hospital by age, sex and socio-economic deprivation in England using the narrow measure.   

1. The 'broad' measure looks across all the diagnoses associated with a spell in hospital (which we take to mean a CIPS) and attributes the admission to hospital to the diagnosis most strongly associated with alcohol, i.e. the diagnosis with the largest alcohol PAF. If two or more diagnoses have the same PAF, then the earliest recorded diagnosis is used. This method has been used to inform estimates of alcohol attributable hospital admissions [@jones2008alcohol]; the Sheffield Alcohol Policy Model also uses it to estimate the baseline rates of hospitalisations used in modelling the potential impact of policies on alcohol attributable hospital admissions [@Brennan2009].           

NHS Digital [@NHSDigitalAlcohol2019] explain that "*The 'broad' measure is a better indicator of the total burden that alcohol has on health services as it takes more account of secondary diagnoses than the 'narrow' measure. However, since secondary diagnosis fields have become better populated over time^[The number of possible diagnosis codes has increased from 14 to 20, and the clinical practice has changed so that more secondary diagnosis codes are being recorded.], this impacts upon time series comparisons for the 'broad' measure as increases can be partly due to an improvement in data quality rather than a real effect. Consequently, the 'narrow' measure is a better indicator of changes over time.*" For example in 2017/18, it was estimated that alcohol was the main reason for 2.1\% of all admissions to hospital using the narrow measure, but using the broad measure, it was estimated that 7.2\% admissions were linked to alcohol.    

### Primary diagnostic position of each episode in a continuous inpatient spell
This method looks at the first diagnostic position of all episodes within a CIPS and retains episodes that have a relevant diagnosis in the primary diagnostic position (i.e. we look at all episodes, not just the admission episode). This was the method that we applied to estimate the cost of tobacco to secondary care for Chapter 3 of the Royal College of Physian's report "Hiding in plain sight: Treating tobacco dependency in the NHS" [@RCP2018]. External causes can be included in the attribution of a diagnosis to each episode following the narrow method for alcohol. The admission is then attributed to the diagnosis in the earliest retained episode, e.g. if the second and third episodes within a CIPS both have relevant diagnoses in the primary diagnostic position, then the admission is attributed to the diagnosis in the primary diagnostic position of the second episode. This is a merger of the narrow and broad methods, but with the removal of the use of the PAF in attributing a diagnosis as the cause of the admission. It balances the risk of incorrectly excluding admissions as being attributable to a diagnosis by looking across all episodes within an admission with the risk of incorrectly including admissions not due to the condition by using only the primary diagnositic positions of each episode. This method should also give a better indication of the total burden that tobacco and alcohol have on health services by taking account of all episodes of care. Further, it should be a robust indicator of changes over time by only making use of the primary diagnostic position within each episode. 

## Estimating the costs of hospital admissions that are attributed to tobacco and alcohol consumption
The choice of approach used to attribute a disease diagnosis as the cause of an admission to hospital also has implications for the estimated costs of hospital admissions that are attributed to tobacco and alcohol consumption. For example, should an entire admission be costed if only one episode within it contains a disease diagnosis that is related to tobacco smoking?    


- What reference costs should be used, and at what level of costing? (e.g. spell or episode level)  
- Should the costs of all episodes within a spell be counted?    
- Should we use the HRG codes and reference costs provided or run the grouper ourselves?


Alternative methods have three different factors: 
Which HRGs are being costed? 
•	Sushrg provided in the HES data 
•	Grouper episode-level HRG 
•	Grouper spell-level HRG 
Which admissions/episodes are being included?
Are you only including admissions where the primary diagnosis of the primary episode is tobacco-related? (PHE)
Or are you including any admission where the primary diagnosis of any episode is tobacco-related? (Narrow)
Or are you including any admissions where any diagnosis of any episodes is tobacco-related? (Broad)
What episodes are being included in the costing?
•	All episodes in an admission (PHE) using spell level cost
•	All episodes in an admission using episode level cost
•	All tobacco-related episodes in an admission (us) 
We are always allocating the cost to the first related condition that arises. 


NICE recommend using the HES grouper for allocating cost using the reference costs, however this does not specify which set of reference costs to use. 



 
A further difficulty in costing hospital admissions is the level of patient care to include. The three measures above commonly cost the entire admission, however the impact of this decision on study findings remains unclear. Inpatient treatment is recorded and costed at episode level, therefore an episode level costing system could provide a more reliable measure.    


Patients often have comorbidities, and each admission to hospital can contain multiple episodes of care, with up to twenty diagnostic codes assigned to each episode. This level of analysis makes it impossible to model how changes in behaviour may result changes to a condition. 



Different methods are required for different investigations. We want to measure the burden of morbidity on individuals in the population; a measure we take to be the most appropriate for modelling the potential future effects on hospitalisations and costs of proposed changes to alcohol and/or tobacco policy. 




# Our choice of methodology



 

## Attributing inpatient care to specific diseases

We will look primarily at the narrow method, and therefore will allocate the cause to the first risk-related diagnosis within an admission (but this does not have to be in the first episode). 
This is what we have already done. 
Causality is assigned based on the first risk-related condition that arises.

## Estimating the costs of hospital admissions that are attributed to tobacco and alcohol consumption

at the moment, we have only included the episodes which have a risk-related primary diagnosis, and excluded the episodes within this admission which don’t. I think we may need to include all episodes within an admission that we are including. 



# Application in tobacco and alcohol policy modelling



introduce person-specific single morbidity admissions






# Discussion

How do methods compare? 
How do our findings relate to/add to the previous guides of what to do? 
How do we expect people who are doing costing to use our findings? 
What might people who use our findings still need to consider for themselves? 
What are the implications of choosing one option over another for the estimated costs of disease? 





Alcohol consumption is common in England, with estimates of x% individuals consuming alcohol and x% individuals having some level of dependence on alcohol. Tobacco smoking has been declining over the last decade however remains at x%, and is the single most important driver of health inequalities. The combination of these factors place a considerable burden on health services. 


how would methods be extended to diet


# References







