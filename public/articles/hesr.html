<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Get started â€¢ hesr</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="16x16" href="../favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="../favicon-32x32.png">
<link rel="apple-touch-icon" type="image/png" sizes="180x180" href="../apple-touch-icon.png">
<link rel="apple-touch-icon" type="image/png" sizes="120x120" href="../apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" type="image/png" sizes="76x76" href="../apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" type="image/png" sizes="60x60" href="../apple-touch-icon-60x60.png">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Get started">
<meta property="og:description" content="hesr">
<meta property="og:image" content="https://stapm.gitlab.io/hesr/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-167990045-1"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-167990045-1');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">hesr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../articles/hesr.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Functions</a>
</li>
<li>
  <a href="../articles/index.html">Technical documentation</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://gitlab.com/stapm/r-packages/hesr">
    <span class="fab fa fab fa-gitlab fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="https://stapm.gitlab.io/software.html">
    <span class="fa fa-code"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="hesr_files/header-attrs-2.5/header-attrs.js"></script><script src="hesr_files/accessible-code-block-0.0.1/empty-anchor.js"></script><link href="hesr_files/anchor-sections-1.0/anchor-sections.css" rel="stylesheet">
<script src="hesr_files/anchor-sections-1.0/anchor-sections.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Get started</h1>
            
      
      
      <div class="hidden name"><code>hesr.Rmd</code></div>

    </div>

    
    
<p>The code behind our <a href="https://stapm.gitlab.io/model-inputs/hosp_eng_methods_report/English_secondary_care_modelling_report.pdf">methodology report</a> is in <a href="https://gitlab.com/stapm/model-inputs/hosp_eng_methods_report">this repo</a>.</p>
<p>To illustrate the use of the <code>hesr</code> functions for different tasks, we have created example workflows. You can use these examples to help understand how the code works, run them to generate model inputs, or use them as a starting point for the development of a new project.</p>
<p>At the moment, these workflows are accessible only to the project team. To access them, you will need to be added to the STAPM Gitlab organisation.</p>
<p>The workflows are listed below:</p>
<ul>
<li>
<a href="https://gitlab.com/stapm/model-inputs/hosp_eng_data_cleaning">Initial preparation of English inpatient care data (run first)</a><br>
</li>
<li>
<a href="https://gitlab.com/stapm/model-inputs/hosp_tob_eng_nat">English national-level tobacco-related rates and costs of inpatient care</a><br>
</li>
<li>
<a href="https://gitlab.com/stapm/model-inputs/hosp_alc_eng_nat">English national-level alcohol-related rates and costs of inpatient care</a><br>
</li>
<li><a href="https://gitlab.com/stapm/model-inputs/hosp_tobalc_eng_nat">English national-level tobacco- and alcohol-related rates and costs of inpatient care</a></li>
</ul>
<div id="basic-functionality" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-functionality" class="anchor"></a>Basic functionality</h2>
<div id="load-and-clean-data" class="section level3">
<h3 class="hasAnchor">
<a href="#load-and-clean-data" class="anchor"></a>Load and clean data</h3>
<p>The following code will read and clean the data for 2002/03.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hes_data</span> <span class="op">&lt;-</span> <span class="kw">function</span><span class="op">(</span><span class="op">)</span> <span class="op">{</span>

  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/read_hes.html">read_hes</a></span><span class="op">(</span><span class="st">"0203"</span><span class="op">)</span>
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/clean_hes.html">clean_hes</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/define_spells.html">define_spells</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/local_authority.html">local_authority</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"0203"</span><span class="op">)</span>
  <span class="va">data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/append_hrg_codes.html">append_hrg_codes</a></span><span class="op">(</span><span class="va">data</span>, <span class="st">"0203"</span><span class="op">)</span>
  
<span class="kw"><a href="https://rdrr.io/r/base/function.html">return</a></span><span class="op">(</span><span class="va">data</span><span class="op">)</span>
<span class="op">}</span></code></pre></div>
</div>
<div id="summarise-data" class="section level3">
<h3 class="hasAnchor">
<a href="#summarise-data" class="anchor"></a>Summarise data</h3>
<p>This is example code of summarising the cleaned HES data for the year 2016/17 into alcohol-related episodes using the narrow method. This will produce a summary table of number of episodes related to each condition by sex, age group and IMD quintile.</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hes_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assign_risk.html">assign_risk</a></span><span class="op">(</span>hes <span class="op">=</span> <span class="va">hes_data</span>, k.year.ind <span class="op">=</span> <span class="st">"1617"</span>, 
  youngest_age <span class="op">=</span> <span class="fl">16</span>,
  age_cat <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"16-17"</span>, <span class="st">"18-24"</span>, <span class="st">"25-34"</span>, <span class="st">"35-49"</span>, <span class="st">"50-64"</span>, <span class="st">"65-74"</span>, <span class="st">"75-89"</span><span class="op">)</span>,
  age_cat_start <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">16</span>, <span class="fl">18</span>, <span class="fl">25</span>, <span class="fl">35</span>, <span class="fl">50</span>, <span class="fl">65</span>, <span class="fl">75</span><span class="op">)</span>,
  method <span class="op">=</span> <span class="st">"Narrow"</span>, 
  substance <span class="op">=</span> <span class="st">"Alcohol"</span>,
  aaf_lkup <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span><span class="op">(</span><span class="st">"//tsclient/X/ScHARR/PR_Disease_Risk_TA/Code/Attributable_fractions/Alcohol_attributable_fractions/Output/Archive/aafs_long_2016.csv"</span><span class="op">)</span>,
  level <span class="op">=</span> <span class="st">"Episode"</span>, 
  summary <span class="op">=</span> <span class="cn">TRUE</span>,  
  dir <span class="op">=</span> <span class="st">"D:/HES/working_data_files"</span><span class="op">)</span></code></pre></div>
</div>
<div id="calculate-costs" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-costs" class="anchor"></a>Calculate costs</h3>
<p>Calculating the cost of admissions in the latest year to assign to all years. Only need to run the function <code><a href="../reference/calc_cost_admission.html">hesr::calc_cost_admission()</a></code>, which will read in raw HES data, clean the HES data using both functions above, match to the reference costs, trimpoints, and OPCS costs to first calculate unit episode costs. It uses the function <code>hesr::missing costs()</code> to fill in missing costs and create average unit costs of admissions by condition, sex, IMD quintile, and age category.</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">costed_hes</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/calc_cost_admission.html">calc_cost_admission</a></span><span class="op">(</span>k.year.ind <span class="op">=</span> <span class="st">"1617"</span><span class="op">)</span></code></pre></div>
</div>
<div id="assign-costs-to-data" class="section level3">
<h3 class="hasAnchor">
<a href="#assign-costs-to-data" class="anchor"></a>Assign costs to data</h3>
<p>This is example code of assigning the unit admission costs to the summarised HES data. The first line summarises the data as above, but reduces the data further down into admission level. This will produce a summary table of the number of admissions related to alcohol in 2016/17 by condition, sex, age group, and IMD quintile. The second line merges this summary table with the table of unit admissions costs, which are also stratified by age group, sex, and IMD quintile.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">hes_data</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/assign_risk.html">assign_risk</a></span><span class="op">(</span>
  <span class="va">hes_data</span>,
  <span class="st">"1617"</span>,
  method <span class="op">=</span> <span class="st">"Narrow"</span>,
  substance <span class="op">=</span> <span class="st">"Alcohol"</span>,
  level <span class="op">=</span> <span class="st">"Admission"</span>,
  summary <span class="op">=</span> <span class="cn">TRUE</span>
<span class="op">)</span>

<span class="va">costed_hes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://Rdatatable.gitlab.io/data.table/reference/merge.html">merge</a></span><span class="op">(</span>
  <span class="va">hes_data</span>,
  <span class="fu">hesr</span><span class="fu">::</span><span class="va">unit_cost_admission</span>,
  by <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"age_cat"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>, <span class="st">"Cause"</span><span class="op">)</span>,
  all.x <span class="op">=</span> <span class="cn">T</span>,
  all.y <span class="op">=</span> <span class="cn">F</span>
<span class="op">)</span></code></pre></div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/gillespie_d">Duncan Gillespie</a>, Laura Webster, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/angus_c">Colin Angus</a>, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/brennan_a">Alan Brennan</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
