<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Process Hospital Episode Statistics data • hesr</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/flatly/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Process Hospital Episode Statistics data">
<meta property="og:description" content="A collection of functions to read, clean and analyse admitted patient care hospital episode statistics data.">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">hesr</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.1</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="articles/cleaning_and_costing.html">Cleaning and costing</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="contents col-md-9">
<div id="process-hospital-episode-statistics-data-" class="section level1">
<div class="page-header"><h1 class="hasAnchor">
<a href="#process-hospital-episode-statistics-data-" class="anchor"></a>Process Hospital Episode Statistics data <img src="tools/hesr_hex.png" align="right" style="padding-left:10px;background-color:white;" width="100" height="100">
</h1></div>

<p><strong>DRAFT WORKING VERSION</strong> - The package is usable but there are still bugs and further developments that are being worked through i.e. some code and documentation is still incomplete or in need of being refined. The code and documentation are still undergoing internal review by the analyst team.</p>
<div id="motivation" class="section level2">
<h2 class="hasAnchor">
<a href="#motivation" class="anchor"></a>Motivation</h2>
<p><code>hesr</code> was created as part of a programme of work on the health economics of tobacco and alcohol at the School of Health and Related Research (ScHARR), The University of Sheffield. This programme is based around the construction of the Sheffield Tobacco and Alcohol Policy Model (STAPM), which aims to use comparable methodologies to evaluate the impacts of tobacco and alcohol policies, and investigate the consequences of clustering and interactions between tobacco and alcohol consumption behaviours.</p>
<p>The original motivation for <code>hesr</code> was to standardised the way that the Admitted Patient Care (APC) portion of the English Hospital Episode Statistics (HES) were processed to produce inputs to our decision-analytic models. The <a href="https://digital.nhs.uk/data-and-information/data-tools-and-services/data-services/hospital-episode-statistics">HES data</a> is a data warehouse in which the APC portion contains details of all admissions to hospital. The suite of functions within <code>hesr</code> reads the data for each year since 2002/03, renames, organises and processes the variables that we use for our analyses.</p>
<blockquote>
<p>Hospital Episode Statistics are accessed via a data sharing agreement with NHS Digital.</p>
</blockquote>
</div>
<div id="usage" class="section level2">
<h2 class="hasAnchor">
<a href="#usage" class="anchor"></a>Usage</h2>
<p><code>hesr</code> is a package for reading, cleaning and analysing the English Admitted Patient Care Hospital Episode Statistics.</p>
<p>The <strong>inputs</strong> are the raw data files for each year and the list of diseases attributable to tobacco and/or alcohol (defined by ICD-10 codes).</p>
<p>The <strong>processes</strong> applied by the functions in <code>hesr</code> give options to:</p>
<ol>
<li>Read each year of data.<br>
</li>
<li>Define spells.<br>
</li>
<li>Identify tobacco and alcohol related episodes and spells.<br>
</li>
<li>Calculate rates of hospital admission for tobacco and/or alcohol related causes.<br>
</li>
<li>Stratify rates by age, sex, socio-economic conditions (defined by Index of Multiple Deprivation) and geographical region.<br>
</li>
<li>Calculate the unit costs of hospital admissions.</li>
</ol>
<p>The <strong>output</strong> of these processes is a set of rates that describe admission to hospital, and a set of unit costs for use in health economic modelling of the effects of changes to tobacco and/or alcohol consumption.</p>
</div>
<div id="installation" class="section level2">
<h2 class="hasAnchor">
<a href="#installation" class="anchor"></a>Installation</h2>
<p><code>hesr</code> is currently available only to members of the project team (but please contact Duncan Gillespie <a href="mailto:duncan.gillespie@sheffield.ac.uk" class="email">duncan.gillespie@sheffield.ac.uk</a> to discuss). To access you need to <a href="https://gitlab.com/"><strong>sign-up for a GitLab account</strong></a>. You will then need to be added to the STAPM project team to gain access.</p>
<p>Once that is sorted, you can <strong>install the development version of <code>hesr</code></strong> from GitLab with:</p>
<div class="sourceCode" id="cb1"><pre class="r"><span class="co">#install.packages("devtools")</span>
<span class="co">#install.packages("getPass")</span>

<span class="kw pkg">devtools</span><span class="kw ns">::</span><span class="fu"><a href="https://devtools.r-lib.org//reference/remote-reexports.html">install_git</a></span>(
  <span class="st">"https://gitlab.com/stapm/hesr.git"</span>,
  <span class="kw">credentials</span> <span class="kw">=</span> <span class="kw pkg">git2r</span><span class="kw ns">::</span><span class="fu"><a href="https://docs.ropensci.org/git2r/reference/cred_user_pass.html">cred_user_pass</a></span>(<span class="st">"uname"</span>, <span class="kw pkg">getPass</span><span class="kw ns">::</span><span class="fu"><a href="https://rdrr.io/pkg/getPass/man/getPass.html">getPass</a></span>()),
  <span class="kw">ref</span> <span class="kw">=</span> <span class="st">"x.x.x"</span>,
  <span class="kw">build_vignettes</span> <span class="kw">=</span> <span class="fl">TRUE</span>
)

<span class="co"># Where uname is your Gitlab user name.</span>
<span class="co"># ref = "x.x.x" is the version to install - remove this to install the latest version</span>
<span class="co"># this should make a box pop up where you enter your GitLab password</span></pre></div>
<p>Then load the package, and some other packages that are useful. Note that the code within <code>hesr</code> uses the <code><a href="https://Rdatatable.gitlab.io/data.table/reference/data.table.html">data.table::data.table()</a></code> syntax.</p>
<div class="sourceCode" id="cb2"><pre class="r"><span class="co"># Load the package</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">hesr</span>)

<span class="co"># Other useful packages</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">dplyr</span>) <span class="co"># for data manipulation and summary</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">magrittr</span>) <span class="co"># for pipes</span>
<span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">ggplot2</span>) <span class="co"># for plotting</span></pre></div>
</div>
<div id="citation" class="section level2">
<h2 class="hasAnchor">
<a href="#citation" class="anchor"></a>Citation</h2>
<p>Please cite the latest version of the package using:<br>
“Duncan Gillespie, Laura Webster, Colin Angus and Alan Brennan (2020). hesr: Read, Clean and Analyse English Admitted Patient Care Hospital Episode Statistics. R package version x.x.x. <a href="https://stapm.gitlab.io/hesr" class="uri">https://stapm.gitlab.io/hesr</a>.”</p>
</div>
<div id="getting-started" class="section level2">
<h2 class="hasAnchor">
<a href="#getting-started" class="anchor"></a>Getting started</h2>
<p>In ScHARR, all data is stored and processed according to the <a href="https://www.sheffield.ac.uk/scharr/research/igov/policy00">ScHARR Information Governance Policy</a>. The HES data is stored on the University of Sheffield managed <code>heta_study</code> virtual machine, which is accessible only to team members who are using data. The working folder on the university networked X-drive is <code>PR_HES_data_TA</code>. No individual-level data is included within this package.</p>
<p>We have given a brief description of our use of the HES data in the <a href="https://www.sheffield.ac.uk/scharr/sections/ph/research/alpol/research/geographic_and_socioeconomic_variation_in_alcohol_and_tobacco_related_hospital_admissions">privacy notice</a>.</p>
</div>
<div id="basic-functionality" class="section level2">
<h2 class="hasAnchor">
<a href="#basic-functionality" class="anchor"></a>Basic functionality</h2>
<div id="load-and-clean-data" class="section level3">
<h3 class="hasAnchor">
<a href="#load-and-clean-data" class="anchor"></a>Load and clean data</h3>
<p>The following code will read and clean the data for 2002/03.</p>
<div class="sourceCode" id="cb3"><pre class="r"><span class="no">hes_data</span> <span class="kw">&lt;-</span> <span class="kw">function</span>() {

  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/read_hes.html">read_hes</a></span>(<span class="st">"0203"</span>)
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/clean_hes.html">clean_hes</a></span>(<span class="no">data</span>)
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/define_spells.html">define_spells</a></span>(<span class="no">data</span>)
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/local_authority.html">local_authority</a></span>(<span class="no">data</span>, <span class="st">"0203"</span>)
  <span class="no">data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/append_hrg_codes.html">append_hrg_codes</a></span>(<span class="no">data</span>, <span class="st">"0203"</span>)

<span class="fu"><a href="https://rdrr.io/r/base/function.html">return</a></span>(<span class="no">data</span>)
}</pre></div>
</div>
<div id="summarise-data" class="section level3">
<h3 class="hasAnchor">
<a href="#summarise-data" class="anchor"></a>Summarise data</h3>
<p>This is example code of summarising the cleaned HES data for the year 2016/17 into alcohol-related episodes using the narrow method. This will produce a summary table of number of episodes related to each condition by sex, age group and IMD quintile.</p>
<div class="sourceCode" id="cb4"><pre class="r"><span class="no">hes_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/assign_risk.html">assign_risk</a></span>(<span class="kw">hes</span> <span class="kw">=</span> <span class="no">hes_data</span>, <span class="kw">k.year.ind</span> <span class="kw">=</span> <span class="st">"1617"</span>,
  <span class="kw">youngest_age</span> <span class="kw">=</span> <span class="fl">16</span>,
  <span class="kw">age_cat</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"16-17"</span>, <span class="st">"18-24"</span>, <span class="st">"25-34"</span>, <span class="st">"35-49"</span>, <span class="st">"50-64"</span>, <span class="st">"65-74"</span>, <span class="st">"75-89"</span>),
  <span class="kw">age_cat_start</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">16</span>, <span class="fl">18</span>, <span class="fl">25</span>, <span class="fl">35</span>, <span class="fl">50</span>, <span class="fl">65</span>, <span class="fl">75</span>),
  <span class="kw">method</span> <span class="kw">=</span> <span class="st">"Narrow"</span>,
  <span class="kw">substance</span> <span class="kw">=</span> <span class="st">"Alcohol"</span>,
  <span class="kw">aaf_lkup</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/utils/read.table.html">read.csv</a></span>(<span class="st">"//tsclient/X/ScHARR/PR_Disease_Risk_TA/Code/Attributable_fractions/Alcohol_attributable_fractions/Output/Archive/aafs_long_2016.csv"</span>),
  <span class="kw">level</span> <span class="kw">=</span> <span class="st">"Episode"</span>,
  <span class="kw">summary</span> <span class="kw">=</span> <span class="fl">TRUE</span>,
  <span class="kw">dir</span> <span class="kw">=</span> <span class="st">"D:/HES/working_data_files"</span>)</pre></div>
</div>
<div id="calculate-costs" class="section level3">
<h3 class="hasAnchor">
<a href="#calculate-costs" class="anchor"></a>Calculate costs</h3>
<p>Calculating the cost of admissions in the latest year to assign to all years. Only need to run the function <code><a href="reference/calc_cost_admission.html">hesr::calc_cost_admission()</a></code>, which will read in raw HES data, clean the HES data using both functions above, match to the reference costs, trimpoints, and OPCS costs to first calculate unit episode costs. It uses the function <code>hesr::missing costs()</code> to fill in missing costs and create average unit costs of admissions by condition, sex, IMD quintile, and age category.</p>
<div class="sourceCode" id="cb5"><pre class="r"><span class="no">costed_hes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/calc_cost_admission.html">calc_cost_admission</a></span>(<span class="kw">k.year.ind</span> <span class="kw">=</span> <span class="st">"1617"</span>)</pre></div>
</div>
<div id="assign-costs-to-data" class="section level3">
<h3 class="hasAnchor">
<a href="#assign-costs-to-data" class="anchor"></a>Assign costs to data</h3>
<p>This is example code of assigning the unit admission costs to the summarised HES data. The first line summarises the data as above, but reduces the data further down into admission level. This will produce a summary table of the number of admissions related to alcohol in 2016/17 by condition, sex, age group, and IMD quintile. The second line merges this summary table with the table of unit admissions costs, which are also stratified by age group, sex, and IMD quintile.</p>
<div class="sourceCode" id="cb6"><pre class="r"><span class="no">hes_data</span> <span class="kw">&lt;-</span> <span class="fu"><a href="reference/assign_risk.html">assign_risk</a></span>(
  <span class="no">hes_data</span>,
  <span class="st">"1617"</span>,
  <span class="kw">method</span> <span class="kw">=</span> <span class="st">"Narrow"</span>,
  <span class="kw">substance</span> <span class="kw">=</span> <span class="st">"Alcohol"</span>,
  <span class="kw">level</span> <span class="kw">=</span> <span class="st">"Admission"</span>,
  <span class="kw">summary</span> <span class="kw">=</span> <span class="fl">TRUE</span>
)

<span class="no">costed_hes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/merge.html">merge</a></span>(
  <span class="no">hes_data</span>,
  <span class="kw pkg">hesr</span><span class="kw ns">::</span><span class="no">unit_cost_admission</span>,
  <span class="kw">by</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"age_cat"</span>, <span class="st">"sex"</span>, <span class="st">"imd_quintile"</span>, <span class="st">"Cause"</span>),
  <span class="kw">all.x</span> <span class="kw">=</span> <span class="no">T</span>,
  <span class="kw">all.y</span> <span class="kw">=</span> <span class="no">F</span>
)</pre></div>
</div>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2>Links</h2>
<ul class="list-unstyled">
<li>STAPM webpage at <br><a href="https://stapm.gitlab.io/">https://​stapm.gitlab.io/​</a>
</li>
<li>Privacy notice at <br><a href="https://stapm.gitlab.io/HES_privacy_notice.html">https://​stapm.gitlab.io/​HES_privacy_notice.html</a>
</li>
</ul>
</div>
<div class="license">
<h2>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3">GPL-3</a></small></li>
</ul>
</div>
<div class="developers">
<h2>Developers</h2>
<ul class="list-unstyled">
<li>
<a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/gillespie_d">Duncan Gillespie</a> <br><small class="roles"> Author, maintainer </small> <a href="https://orcid.org/0000-0003-3450-5747" target="orcid.widget" aria-label="ORCID"><span class="fab fa-orcid orcid" aria-hidden="true"></span></a> </li>
<li>Laura Webster <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/angus_c">Colin Angus</a> <br><small class="roles"> Author </small>  </li>
<li>
<a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/brennan_a">Alan Brennan</a> <br><small class="roles"> Author </small>  </li>
</ul>
</div>

  <div class="dev-status">
<h2>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://www.repostatus.org/#active"><img src="https://www.repostatus.org/badges/latest/active.svg" alt="Project Status: Active – The project has reached a stable, usable state and is being actively developed."></a></li>
</ul>
</div>
</div>
</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/gillespie_d">Duncan Gillespie</a>, Laura Webster, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/angus_c">Colin Angus</a>, <a href="https://www.sheffield.ac.uk/scharr/sections/heds/staff/brennan_a">Alan Brennan</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
